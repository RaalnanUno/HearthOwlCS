<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Map Pins (No API Key) - Leaflet + OSM</title>

    <!-- Bootstrap (CSS) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Leaflet (CSS) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <style>
      body {
        background: #f8f9fa;
      }
      #map {
        height: 70vh;
        min-height: 420px;
        border-radius: 0.75rem;
      }
      .loc-list {
        max-height: 70vh;
        overflow: auto;
      }
      .loc-item {
        cursor: pointer;
        user-select: none;
      }
      .loc-item:hover {
        background: #f1f3f5;
      }
      .badge-coords {
        font-family:
          ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }
    </style>
  </head>

  <body>
    <div class="container py-4">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h1 class="h4 mb-1">Map Pinpoints (No API key)</h1>
          <div class="text-muted small">
            Leaflet + OpenStreetMap tiles â€¢ Locations loaded from JSON
          </div>
        </div>

        <button id="btnFit" class="btn btn-outline-primary btn-sm">
          Fit to pins
        </button>
      </div>

      <div class="row g-3">
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body">
              <div id="map"></div>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <div
                class="d-flex align-items-center justify-content-between mb-2"
              >
                <div class="fw-semibold">Locations</div>
                <span class="badge text-bg-secondary" id="locCount">0</span>
              </div>

              <input
                id="txtFilter"
                class="form-control form-control-sm mb-3"
                placeholder="Filter by name..."
              />

              <div id="locList" class="list-group loc-list"></div>

              <div class="text-muted small mt-3">
                Tip: swap the <code>locations</code> JSON with an AJAX call
                later.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-body">
          <div class="fw-semibold mb-2">Locations JSON (starter)</div>
          <pre class="mb-0"><code id="jsonPreview"></code></pre>
        </div>
      </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Bootstrap (JS) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet (JS) -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <script>
      // ------------------------------------------------------------
      // STARTER DATA (JSON)
      // ------------------------------------------------------------
      // Replace this with your API call later (same structure).
      // IMPORTANT: lat/lng are numbers.
      const locations = [
        {
          id: 1,
          name: "Rocky Mount, NC",
          lat: 35.9382,
          lng: -77.7905,
          description: "Example pin near Rocky Mount.",
        },
        // example location
        {
          id: 2,
          name: "Raleigh, NC",
          lat: 35.7796,
          lng: -78.6382,
          description: "State capital.",
          color: "red",
        },
        {
          id: 3,
          name: "Charlotte, NC",
          lat: 35.2271,
          lng: -80.8431,
          description: "Largest city in NC.",
        },
        {
          id: 4,
          name: "Washington, DC",
          lat: 38.9072,
          lng: -77.0369,
          description: "Example out-of-state pin.",
        },
      ];

      // ------------------------------------------------------------
      // MAP INIT
      // ------------------------------------------------------------
      const map = L.map("map", {
        zoomControl: true,
        scrollWheelZoom: true,
      });

function makePinIcon(colorClass) {
  // colorClass examples: "text-primary", "text-danger", "text-success", "text-warning"
  return L.divIcon({
    className: "",
    iconSize: [24, 24],
    iconAnchor: [12, 24],
    popupAnchor: [0, -24],
    html: `<i class="bi bi-geo-alt-fill ${colorClass}" style="font-size:24px; text-shadow:0 1px 2px rgba(0,0,0,.35);"></i>`
  });
}

      // OpenStreetMap tile layer (no API key)
      const tileLayer = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          maxZoom: 19,
          attribution: "&copy; OpenStreetMap contributors",
        },
      ).addTo(map);

      // Marker storage (id -> marker)
      const markersById = new Map();

      // Keep bounds so we can fit later (must be LET because we reassign it)
      let bounds = L.latLngBounds([]);

      // ------------------------------------------------------------
      // MARKERS
      // ------------------------------------------------------------
      function buildMarkers(data) {
        // remove existing markers
        markersById.forEach((m) => map.removeLayer(m));
        markersById.clear();

        // reset bounds
        bounds = L.latLngBounds([]);

        data.forEach((loc) => {
          const marker = L.circleMarker([loc.lat, loc.lng], {
  radius: 8,
  color: loc.color || "blue",      // outline
  weight: 2,
  fillColor: loc.color || "blue",  // fill
  fillOpacity: 0.9
})
  .addTo(map)
  .bindPopup(`
            <div style="min-width: 220px;">
              <div class="fw-semibold">${escapeHtml(loc.name)}</div>
              <div class="text-muted small mb-2">
                <span class="badge text-bg-light badge-coords">${loc.lat.toFixed(4)}, ${loc.lng.toFixed(4)}</span>
              </div>
              ${loc.description ? `<div>${escapeHtml(loc.description)}</div>` : ""}
            </div>
          `);

          markersById.set(loc.id, marker);
          bounds.extend([loc.lat, loc.lng]);
        });
      }

      function fitToPins() {
        if (bounds.isValid()) {
          map.fitBounds(bounds.pad(0.2));
        } else {
          map.setView([39.5, -98.35], 4); // USA-ish default
        }
      }

      // ------------------------------------------------------------
      // LIST UI
      // ------------------------------------------------------------
      function renderList(data) {
        $("#locCount").text(data.length);
        const $list = $("#locList").empty();

        if (data.length === 0) {
          $list.append(`<div class="text-muted small">No matches.</div>`);
          return;
        }

        data.forEach((loc) => {
          const $item = $(`
          <div class="list-group-item loc-item">
            <div class="d-flex align-items-start justify-content-between">
              <div>
                <div class="fw-semibold">${escapeHtml(loc.name)}</div>
                <div class="text-muted small">${loc.lat.toFixed(4)}, ${loc.lng.toFixed(4)}</div>
              </div>
              <span class="badge text-bg-primary">Pin</span>
            </div>
            ${loc.description ? `<div class="small mt-1">${escapeHtml(loc.description)}</div>` : ""}
          </div>
        `);

          $item.on("click", () => {
            const marker = markersById.get(loc.id);
            if (!marker) return;

            map.setView(marker.getLatLng(), Math.max(map.getZoom(), 12), {
              animate: true,
            });
            marker.openPopup();
          });

          $list.append($item);
        });
      }

      function applyFilter() {
        const term = ($("#txtFilter").val() || "")
          .toString()
          .trim()
          .toLowerCase();
        if (!term) return locations;

        return locations.filter(
          (l) =>
            (l.name || "").toLowerCase().includes(term) ||
            (l.description || "").toLowerCase().includes(term),
        );
      }

      // ------------------------------------------------------------
      // SAFETY: basic HTML escape for popup/list text
      // ------------------------------------------------------------
      function escapeHtml(str) {
        return (str ?? "")
          .toString()
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      // ------------------------------------------------------------
      // BOOT
      // ------------------------------------------------------------
      $(function () {
        $("#jsonPreview").text(JSON.stringify(locations, null, 2));

        buildMarkers(locations);
        fitToPins();
        renderList(locations);

        $("#txtFilter").on("input", () => {
          const filtered = applyFilter();
          buildMarkers(filtered);
          fitToPins();
          renderList(filtered);
        });

        $("#btnFit").on("click", fitToPins);
      });
    </script>
  </body>
</html>
